<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>HealthTask App</title>

  <style>
    :root{
      --color-bg-start:#051937;
      --color-bg-mid:#008793;
      --color-bg-end:#a8eb12;
      --color-card-bg:rgba(255,255,255,0.12);
      --color-card-border:rgba(255,255,255,0.30);
      --color-text:#fff;
      --color-accent:#7faaf8;
      --color-active:#10b981; /* groen actief */
      --bubble-size:20px;
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;
    }

    html,body{ margin:0; height:100%; color:var(--color-text); overflow-x:hidden; position:relative; }
    body{ display:flex; flex-direction:column; align-items:center; min-height:100vh; }

    /* animated calm background */
    .bg{
      position:fixed; inset:0; z-index:-10;
      background-image:linear-gradient(to right bottom,var(--color-bg-start),#004d7a,var(--color-bg-mid),#00bf72,var(--color-bg-end));
      background-size:500% 500%;
      animation:gradientShift 25s ease-in-out infinite;
    }
    @keyframes gradientShift{
      0%{background-position:100% 0%} 50%{background-position:0% 100%} 100%{background-position:100% 0%}
    }
    #clouds{ position:fixed; inset:0; pointer-events:none; z-index:-5; }
    .cloud{
      position:absolute; border-radius:50%; opacity:.25; filter:blur(80px);
      background:radial-gradient(circle at 30% 30%,rgba(255,255,255,.6) 0%,rgba(255,255,255,.2) 60%,transparent 100%);
      animation:cloudHue 40s linear infinite, cloudFloat 50s ease-in-out infinite;
    }
    .cloud1{ top:15%; left:20%; width:260px; height:220px; }
    .cloud2{ top:45%; left:65%; width:300px; height:260px; animation-delay:8s; }
    .cloud3{ top:75%; left:30%; width:240px; height:200px; animation-delay:16s; }
    .cloud4{ top:25%; left:80%; width:220px; height:240px; animation-delay:24s; }
    @keyframes cloudHue{ 0%{filter:hue-rotate(0)} 50%{filter:hue-rotate(120deg)} 100%{filter:hue-rotate(360deg)} }
    @keyframes cloudFloat{ 0%,100%{transform:translate(0,0)} 50%{transform:translate(-40px,-20px)} }

    /* header */
    #app-header{
      width:calc(100% - 40px); margin:20px; padding:20px;
      display:flex; justify-content:space-between; align-items:flex-start;
      border-radius:24px; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.25);
      backdrop-filter:blur(20px); box-shadow:0 4px 12px rgba(0,0,0,.25); z-index:1;
    }
    .header-time{ display:flex; align-items:center; }
    .live-time{ font-size:1.4rem; font-weight:500; }
    .header-weather{ flex:1; display:flex; justify-content:center; }
    .header-tasks button{
      background:#6d8bdc; color:#fff; border:none; padding:8px 12px; border-radius:10px;
      box-shadow:0 2px 4px rgba(0,0,0,.3); cursor:pointer; font-weight:700;
    }

    /* events area ‚Äî blocksquare, gecentreerd */
    #events-container{
      width:100%; max-width:860px; padding:0 20px 140px; margin:0 auto; box-sizing:border-box;
      -webkit-overflow-scrolling:touch; touch-action:pan-y;
    }
    .event-card{
      width:100%; max-width:820px; margin:16px auto; padding:20px; box-sizing:border-box;
      display:flex; flex-direction:column; align-items:center;
      background:var(--color-card-bg); border:1px solid var(--color-card-border);
      border-radius:20px; box-shadow:0 8px 16px rgba(0,0,0,.1); backdrop-filter:blur(18px);
      transition:transform .2s ease;
    }
    .event-card:active{ transform:scale(.998); }

    .card-header{ width:100%; display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; }
    .event-title{ margin:0 auto; display:flex; align-items:center; gap:10px; font-size:1.1rem; font-weight:700; }
    .event-title span.icon{ font-size:24px; }
    .min-btn{ background:none; border:none; color:#fff; font-size:22px; cursor:pointer; margin-left:auto; }

    .timeline{ width:100%; max-width:760px; }
    .zone-group{ margin-top:14px; }
    .zone-title{ font-size:.8rem; opacity:.9; text-align:center; margin-bottom:6px; }
    .zone-row{
      display:grid; grid-template-columns:repeat(auto-fill,minmax(52px,1fr));
      gap:10px; align-items:center; justify-items:center;
    }
    .slot-col{ display:flex; flex-direction:column; align-items:center; }
    .slot-time{ font-size:.7rem; opacity:.85; }

    .bubble{
      width:var(--bubble-size); height:var(--bubble-size); border-radius:50%;
      border:2px solid rgba(255,255,255,.5); background:rgba(255,255,255,.15);
      transition:background .15s ease, transform .15s ease, box-shadow .15s ease;
      cursor:pointer;
    }
    .bubble.active{
      background:var(--color-accent); border-color:var(--color-accent); transform:scale(1.1);
      box-shadow:0 0 4px rgba(255,255,255,.6) inset, 0 0 6px var(--color-accent);
    }

    /* footer chips (minimized) */
    #footer{
      position:fixed; left:0; bottom:0; width:100%;
      display:flex; gap:8px; padding:8px 12px; box-sizing:border-box;
      background:rgba(0,0,0,.15); backdrop-filter:blur(12px); overflow-x:auto; z-index:2;
    }
    .footer-chip{
      display:flex; align-items:center; gap:8px; padding:6px 10px; border-radius:18px;
      background:var(--color-card-bg); border:1px solid var(--color-card-border);
      backdrop-filter:blur(10px); box-shadow:0 4px 8px rgba(0,0,0,.1); white-space:nowrap;
    }
    .footer-chip button{ background:none; border:none; color:#fff; font-size:1rem; cursor:pointer; }

    /* taken overlay ‚Äî zelfde calm/glass stijl */
    #tasksPage{
      position:fixed; inset:0; display:none; z-index:3;
      background:rgba(0,0,0,.55); backdrop-filter:blur(6px);
      padding:40px 20px; box-sizing:border-box; overflow-y:auto;
      -webkit-overflow-scrolling:touch; touch-action:pan-y;
    }
    #tasksPage h2{ text-align:center; margin-bottom:16px; }
    #moodSection{ margin-bottom:32px; }

    /* assignee toggles (vervanger van drag&drop) */
    .assignee-bar{
      margin-top:8px; display:flex; align-items:center; justify-content:space-between;
      padding:10px 12px; border-radius:14px;
      background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.25);
    }
    .assignee-label{ opacity:.9; font-size:.95rem; }
    .assignee-toggles{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; }

    .person-toggle{
      padding:6px 10px; border-radius:12px; border:1px solid rgba(255,255,255,.35);
      background:rgba(255,255,255,.10); color:#fff; font-weight:700; cursor:pointer;
      backdrop-filter:blur(10px);
    }
    .person-toggle.active{
      background:var(--color-active); border-color:var(--color-active);
      box-shadow:0 0 0 2px rgba(16,185,129,.25) inset;
    }

    .task-item{ margin-bottom:14px; }
    .task-text{
      width:100%; padding:10px; border-radius:12px; color:#fff;
      border:1px solid rgba(255,255,255,.25); background:rgba(255,255,255,.10);
    }

    /* motion respect */
    @media (prefers-reduced-motion:reduce){
      .bg,.cloud{ animation:none !important; }
    }

    /* scroll-behavior safety */
    html,body{ overscroll-behavior-y:contain; }
  </style>
</head>
<body>
  <div class="bg"></div>
  <div id="clouds">
    <div class="cloud cloud1"></div><div class="cloud cloud2"></div>
    <div class="cloud cloud3"></div><div class="cloud cloud4"></div>
  </div>

  <!-- Header -->
  <div id="app-header">
    <div class="header-time"><div class="live-time" id="liveClock"></div></div>
    <div class="header-weather" id="weatherContainer"></div>
    <div class="header-tasks"><button id="toggleTasks">Taken</button></div>
  </div>

  <!-- Main events container -->
  <div id="events-container"></div>

  <!-- Footer for minimized chips -->
  <div id="footer"></div>

  <!-- Tasks Page (overlay) -->
  <div id="tasksPage">
    <button id="closeTasks" style="background:#6d8bdc;color:#fff;border:none;padding:8px 12px;border-radius:10px;float:right;">Sluiten</button>
    <h2>Taken</h2>

    <section id="moodSection">
      <h3>Hoe voel je je vandaag?</h3>
      <div style="display:flex;justify-content:center;gap:16px;margin-bottom:8px;font-size:28px;">
        <span>üò†</span><span>üòï</span><span>üòê</span><span>üôÇ</span><span>üòÑ</span>
      </div>
      <input type="range" id="moodSlider" min="1" max="5" step="1" style="width:100%;">
      <p id="moodLabel" style="text-align:center;margin-top:8px;font-weight:bold;"></p>
    </section>

    <section id="assignSection">
      <h3>Wijs taken toe</h3>

      <!-- Taak 1 -->
      <div class="task-item" data-index="0">
        <input class="task-text" value="" placeholder="Vul taak in">
        <div class="assignee-bar">
          <span class="assignee-label">Kies persoon(en)</span>
          <div class="assignee-toggles">
            <button class="person-toggle" data-person="Floris">Floris</button>
            <button class="person-toggle" data-person="Romee">Romee</button>
            <button class="person-toggle" data-person="Sabine">Sabine</button>
            <button class="person-toggle" data-person="Moeder">Moeder</button>
          </div>
        </div>
      </div>

      <!-- Taak 2 -->
      <div class="task-item" data-index="1">
        <input class="task-text" value="" placeholder="Vul taak in">
        <div class="assignee-bar">
          <span class="assignee-label">Kies persoon(en)</span>
          <div class="assignee-toggles">
            <button class="person-toggle" data-person="Floris">Floris</button>
            <button class="person-toggle" data-person="Romee">Romee</button>
            <button class="person-toggle" data-person="Sabine">Sabine</button>
            <button class="person-toggle" data-person="Moeder">Moeder</button>
          </div>
        </div>
      </div>

      <!-- Taak 3 -->
      <div class="task-item" data-index="2">
        <input class="task-text" value="" placeholder="Vul taak in">
        <div class="assignee-bar">
          <span class="assignee-label">Kies persoon(en)</span>
          <div class="assignee-toggles">
            <button class="person-toggle" data-person="Floris">Floris</button>
            <button class="person-toggle" data-person="Romee">Romee</button>
            <button class="person-toggle" data-person="Sabine">Sabine</button>
            <button class="person-toggle" data-person="Moeder">Moeder</button>
          </div>
        </div>
      </div>

    </section>
  </div>

  <script>
    /* ========= Live Clock ========= */
    function updateClock(){
      const now=new Date();
      const hh=String(now.getHours()).padStart(2,'0');
      const mm=String(now.getMinutes()).padStart(2,'0');
      document.getElementById('liveClock').textContent=hh+':'+mm;
    }
    updateClock(); setInterval(updateClock,1000);

    /* ========= Weather (OpenWeather) ========= */
    const weatherApiKey='a8c8d84ac1c7f9dcf70ad3b2f23b9c9e';
    function getWeatherIcon(cond){
      if(cond==='Clear') return '‚òÄÔ∏è';
      if(cond==='Rain'||cond==='Drizzle') return 'üåßÔ∏è';
      if(cond==='Snow') return '‚ùÑÔ∏è';
      if(cond==='Thunderstorm') return '‚õàÔ∏è';
      return '‚òÅÔ∏è';
    }
    function renderWeather(d){
      const c=document.getElementById('weatherContainer'); if(!d) return;
      const t=d.temp!=null?Math.round(d.temp)+'¬∞C':'';
      c.innerHTML=`<div style="display:flex;flex-direction:column;align-items:center;">
        <div style="font-size:24px;">${getWeatherIcon(d.condition)}</div>
        <div>${t}</div><div style="font-size:12px;opacity:.8;">${d.city||''}</div></div>`;
    }
    function fetchWeather(lat,lon){
      const geo=`https://api.openweathermap.org/geo/1.0/reverse?lat=${lat}&lon=${lon}&limit=1&appid=${weatherApiKey}`;
      const w=`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${weatherApiKey}`;
      Promise.all([fetch(geo),fetch(w)])
        .then(([g,w])=>Promise.all([g.json(),w.json()]))
        .then(([g,w])=>{
          const city=Array.isArray(g)&&g[0]&&g[0].name||'';
          const temp=w.main&&w.main.temp;
          const condition=w.weather&&w.weather[0]&&w.weather[0].main;
          const data={city,temp,condition};
          localStorage.setItem('weatherData',JSON.stringify(data));
          renderWeather(data);
        }).catch(console.error);
    }
    (function initWeather(){
      const cached=localStorage.getItem('weatherData');
      if(cached){ try{ renderWeather(JSON.parse(cached)); }catch(e){} }
      if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(pos=>{
          fetchWeather(pos.coords.latitude,pos.coords.longitude);
        },()=>{});
      }
    })();

    /* ========= Events & Timeslots ========= */
    const PILL='üíä';
    const events=[
      {id:'opgestaan', name:'Opgestaan', icon:'‚òÄÔ∏è'},
      {id:'koffie', name:'Koffie', icon:'‚òï'},
      {id:'maaltijd', name:'Maaltijd', icon:'üçΩÔ∏è'},
      {id:'water', name:'Water', icon:'üíß'},
      {id:'dutje', name:'Dutje', icon:'üò¥'},
      {id:'sport', name:'Sporten', icon:'üèÉ'},
      {id:'meditatie', name:'Meditatie', icon:'üßò'},

      // nieuwe medicatie events
      {id:'risperdal', name:'Risperdal', icon:PILL},
      {id:'d3', name:'D3', icon:'‚òÄÔ∏è'},
      {id:'tentin', name:'Tentin', icon:PILL},
      {id:'pyrozepam', name:'Pyrozepam', icon:PILL},
      {id:'lorazepam', name:'Lorazepam', icon:PILL},
      {id:'magnesium', name:'Magnesium', icon:PILL},
      {id:'ldex', name:'Langwerkende Dex', icon:PILL},
      {id:'b12', name:'B12', icon:PILL},
    ];
    const timeSlots=[
      {time:'06:00',zone:'Ochtend'},{time:'07:00',zone:'Ochtend'},{time:'08:00',zone:'Ochtend'},{time:'09:00',zone:'Ochtend'},{time:'10:00',zone:'Ochtend'},{time:'11:00',zone:'Ochtend'},
      {time:'12:00',zone:'Middag'},{time:'13:00',zone:'Middag'},{time:'14:00',zone:'Middag'},{time:'15:00',zone:'Middag'},{time:'16:00',zone:'Middag'},{time:'17:00',zone:'Middag'},
      {time:'18:00',zone:'Avond'},{time:'19:00',zone:'Avond'},{time:'20:00',zone:'Avond'},{time:'21:00',zone:'Avond'},{time:'22:00',zone:'Avond'},{time:'23:59',zone:'Avond'}
    ];

    const eventsContainer=document.getElementById('events-container');
    const footer=document.getElementById('footer');
    const cardElements={};

    events.forEach(ev=>{
      const card=document.createElement('div');
      card.className='event-card'; card.dataset.eventId=ev.id;

      // header
      const header=document.createElement('div'); header.className='card-header';
      const title=document.createElement('div'); title.className='event-title';
      title.innerHTML=`<span class="icon">${ev.icon}</span><span>${ev.name}</span>`;
      const min=document.createElement('button'); min.className='min-btn'; min.textContent='‚Äì';
      min.addEventListener('click',()=>minimizeEvent(ev.id));
      header.appendChild(title); header.appendChild(min); card.appendChild(header);

      // timeline
      const timeline=document.createElement('div'); timeline.className='timeline';
      let currentZone='', currentRow=null;
      timeSlots.forEach(slot=>{
        if(slot.zone!==currentZone){
          currentZone=slot.zone;
          const group=document.createElement('div'); group.className='zone-group';
          const zt=document.createElement('div'); zt.className='zone-title'; zt.textContent=currentZone;
          const row=document.createElement('div'); row.className='zone-row';
          group.appendChild(zt); group.appendChild(row); timeline.appendChild(group); currentRow=row;
        }
        const col=document.createElement('div'); col.className='slot-col';
        const timeLabel=document.createElement('div'); timeLabel.className='slot-time'; timeLabel.textContent=slot.time;
        const bubble=document.createElement('div'); bubble.className='bubble';
        bubble.dataset.eventId=ev.id; bubble.dataset.time=slot.time;
        bubble.setAttribute('role','button'); bubble.setAttribute('aria-pressed','false');

        // restore
        if(localStorage.getItem('event_'+ev.id+'_'+slot.time)==='1'){
          bubble.classList.add('active'); bubble.setAttribute('aria-pressed','true');
        }
        bubble.addEventListener('click',()=>{
          const key='event_'+ev.id+'_'+slot.time;
          const active=bubble.classList.toggle('active');
          bubble.setAttribute('aria-pressed', active?'true':'false');
          if(active) localStorage.setItem(key,'1'); else localStorage.removeItem(key);
        }, {passive:true});

        col.appendChild(timeLabel); col.appendChild(bubble); currentRow.appendChild(col);
      });
      card.appendChild(timeline);
      eventsContainer.appendChild(card);
      cardElements[ev.id]=card;
    });

    function minimizeEvent(eventId){
      const card=cardElements[eventId]; if(!card) return;
      card.style.display='none';
      const chip=document.createElement('div'); chip.className='footer-chip';
      chip.textContent=events.find(e=>e.id===eventId).name+' ';
      const btn=document.createElement('button'); btn.textContent='+';
      btn.addEventListener('click',()=>restoreEvent(eventId,chip));
      chip.appendChild(btn); footer.appendChild(chip);
    }
    function restoreEvent(eventId,chip){
      const card=cardElements[eventId]; if(card){ card.style.display='flex'; }
      if(chip) chip.remove();
    }

    /* ========= Taken overlay ========= */
    const toggleBtn=document.getElementById('toggleTasks');
    const closeBtn=document.getElementById('closeTasks');
    const tasksPage=document.getElementById('tasksPage');
    toggleBtn.addEventListener('click',()=>{ tasksPage.style.display='block'; },{passive:true});
    closeBtn.addEventListener('click',()=>{ tasksPage.style.display='none'; },{passive:true});

    // Mood
    const moodSlider=document.getElementById('moodSlider');
    const moodLabel=document.getElementById('moodLabel');
    function updateMoodLabel(v){
      const moods=['Boos','Verdrietig','Neutraal','Blij','Heel blij'];
      moodLabel.textContent='Je voelt je: '+moods[v-1];
    }
    moodSlider.value=localStorage.getItem('currentMood')||3;
    updateMoodLabel(moodSlider.value);
    moodSlider.addEventListener('input',e=>{
      updateMoodLabel(e.target.value);
      localStorage.setItem('currentMood', e.target.value);
    },{passive:true});

    /* ========= Assignee toggles (persist) ========= */
    const PEOPLE=["Floris","Romee","Sabine","Moeder"];

    function loadTaskModel(){
      const saved=JSON.parse(localStorage.getItem('assignedTasksV2')||'[]');
      const items=[...document.querySelectorAll('.task-item')];
      return items.map((_,i)=> saved[i] || { text:'', assignees:[] });
    }
    function saveTaskModel(model){ localStorage.setItem('assignedTasksV2', JSON.stringify(model)); }

    let taskModel=loadTaskModel();

    // init UI & bindings
    document.querySelectorAll('.task-item').forEach((row,idx)=>{
      const input=row.querySelector('.task-text');
      input.value = taskModel[idx].text || input.value || '';
      input.placeholder='Vul taak in';
      input.addEventListener('input',()=>{
        taskModel[idx].text=input.value.trim();
        saveTaskModel(taskModel);
      });

      row.querySelectorAll('.person-toggle').forEach(btn=>{
        const name=btn.dataset.person;
        if(taskModel[idx].assignees.includes(name)) btn.classList.add('active');
        btn.addEventListener('click',()=>{
          btn.classList.toggle('active');
          const set=new Set(taskModel[idx].assignees);
          if(btn.classList.contains('active')) set.add(name); else set.delete(name);
          taskModel[idx].assignees=[...set];
          saveTaskModel(taskModel);
        });
      });
    });

    /* ========= Scroll performance safety ========= */
    window.addEventListener('touchstart',()=>{}, {passive:true});
    window.addEventListener('touchmove', ()=>{}, {passive:true});
  </script>
</body>
</html>
